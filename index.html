<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Ads Architect v3.0</title>
    <style>
        :root { --meta-blue: #1877f2; --bg: #0f0f0f; --card: #1e1e1e; --text: #fff; --accent: #00e676; --gold: #ffd700; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; }
        .app-shell { max-width: 1100px; margin: 0 auto; background: var(--card); border: 1px solid #333; border-radius: 16px; padding: 30px; box-shadow: 0 10px 50px rgba(0,0,0,0.7); }

        /* Header */
        h1 { text-align: center; margin-top: 0; background: linear-gradient(90deg, #fff, #888); -webkit-background-clip: text; -webkit-text-fill-color: transparent; letter-spacing: -1px; }
        .badge { background: #222; border: 1px solid #444; padding: 4px 12px; border-radius: 20px; font-size: 11px; text-transform: uppercase; color: var(--meta-blue); font-weight: bold; }
        .usage-bar { text-align: center; font-size: 12px; color: #666; margin-bottom: 25px; border-bottom: 1px solid #333; padding-bottom: 20px; }

        /* Grid Layout */
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
        
        /* Inputs */
        label { display: block; margin-top: 15px; font-size: 11px; color: #888; text-transform: uppercase; font-weight: 700; letter-spacing: 0.5px; }
        input, textarea, select { width: 100%; padding: 14px; background: #0a0a0a; border: 1px solid #333; color: #fff; border-radius: 8px; margin-top: 6px; box-sizing: border-box; font-family: inherit; transition: 0.2s; }
        input:focus, textarea:focus, select:focus { border-color: var(--meta-blue); outline: none; box-shadow: 0 0 0 2px rgba(24, 119, 242, 0.2); }

        /* Generate Button */
        .btn-generate { width: 100%; padding: 18px; border: none; border-radius: 10px; font-weight: 800; font-size: 16px; cursor: pointer; margin-top: 25px; background: linear-gradient(45deg, var(--meta-blue), #006aff); color: white; text-transform: uppercase; transition: 0.2s; }
        .btn-generate:hover { transform: translateY(-2px); box-shadow: 0 5px 20px rgba(24, 119, 242, 0.4); }
        .btn-generate:disabled { background: #444; cursor: not-allowed; transform: none; box-shadow: none; }

        /* Output Area */
        .output-grid { display: grid; grid-template-columns: 1.2fr 0.8fr; gap: 30px; margin-top: 40px; display: none; }
        
        /* Strategy Card */
        .strategy-card { background: #111; padding: 25px; border-radius: 12px; border: 1px solid #333; height: fit-content; }
        .data-row { margin-bottom: 20px; }
        .data-label { color: var(--meta-blue); font-size: 11px; font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 8px; letter-spacing: 1px; }
        .data-value { font-size: 14px; color: #ddd; white-space: pre-wrap; background: #1a1a1a; padding: 12px; border-radius: 6px; border: 1px solid #2a2a2a; line-height: 1.6; }
        
        /* Script Box */
        .script-box { background: #1a1a1a; padding: 15px; border-left: 4px solid var(--accent); border-radius: 6px; margin-top: 20px; font-family: monospace; font-size: 13px; color: #ccc; white-space: pre-wrap; }

        /* Ad Mockup */
        .mockup-container { position: sticky; top: 20px; }
        .ad-preview { background: #fff; color: #000; border-radius: 8px; overflow: hidden; max-width: 400px; margin: 0 auto; box-shadow: 0 10px 30px rgba(0,0,0,0.5); font-family: Helvetica, Arial, sans-serif; border: 1px solid #ccc; }
        .ad-header { padding: 12px; display: flex; align-items: center; }
        .ad-avatar { width: 40px; height: 40px; background: linear-gradient(45deg, #ddd, #eee); border-radius: 50%; margin-right: 10px; }
        .ad-brand-name { font-weight: bold; font-size: 14px; color: #050505; }
        .ad-sponsored { font-size: 12px; color: #65676b; }
        .ad-text-top { padding: 0 12px 12px 12px; font-size: 14px; line-height: 1.4; color: #050505; white-space: pre-line; }
        .ad-image-container { width: 100%; aspect-ratio: 1/1; background: #f0f2f5; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .ad-image-container img { width: 100%; height: 100%; object-fit: cover; display: none; }
        .ad-footer { padding: 12px; background: #f0f2f5; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #e4e6eb; }
        .ad-headline-area { flex: 1; margin-right: 15px; }
        .ad-footer-domain { font-size: 12px; color: #65676b; margin-bottom: 2px; text-transform: lowercase; }
        .ad-headline { font-weight: bold; font-size: 16px; margin-bottom: 2px; color: #050505; line-height: 1.2; }
        .ad-desc { font-size: 12px; color: #65676b; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        
        /* Dynamic CTA Button */
        .ad-cta-btn { background: #e4e6eb; color: #050505; padding: 8px 14px; border-radius: 6px; font-weight: 600; font-size: 14px; text-decoration: none; white-space: nowrap; transition: 0.2s; border: 1px solid #ccc; }
        
        #loader { display: none; text-align: center; color: var(--meta-blue); margin-top: 25px; font-weight: bold; letter-spacing: 1px; animation: pulse 1.5s infinite; }
        @keyframes pulse { 50% { opacity: 0.5; } }
        .error-msg { color: #ff6b6b; background: rgba(255, 107, 107, 0.1); padding: 15px; border-radius: 8px; margin-top: 20px; display: none; text-align: center; border: 1px solid #ff6b6b; }
    </style>
</head>
<body>

<div class="app-shell">
    <div style="text-align: center;">
        <span class="badge">üíé Meta Ads Architect v3.0</span>
        <h1>Ad Strategy & Script Engine</h1>
    </div>

    <div class="usage-bar">Daily Limit: <span id="used" style="color: var(--success); font-weight: bold;">0</span> / 30 Campaigns</div>

    <div class="input-grid">
        <div style="grid-column: span 2;">
            <label>Gemini API Key (Saved Locally)</label>
            <input type="password" id="apiKey" placeholder="Paste your API Key here...">
        </div>
        
        <div>
            <label>Product / Service</label>
            <input type="text" id="topic" placeholder="e.g. AI-Powered Coffee Machine">
        </div>
        
        <div>
            <label>Target Audience</label>
            <input type="text" id="audience" placeholder="e.g. Remote workers who love coffee">
        </div>

        <div>
            <label>Campaign Objective</label>
            <select id="purpose">
                <option value="Sales / Conversions">üí∞ Sales / Conversions (Shop Now)</option>
                <option value="Leads / Signups">üìù Leads / Signups (Sign Up)</option>
                <option value="Brand Awareness">üì¢ Brand Awareness (Learn More)</option>
                <option value="App Installs">üì± App Installs (Install Now)</option>
                <option value="Traffic">üñ±Ô∏è Website Traffic (Learn More)</option>
            </select>
        </div>

        <div>
            <label>Ad Language</label>
            <select id="language">
                <option value="Hinglish (Natural Indian Mix)">üáÆüá≥ Hinglish (Conversational)</option>
                <option value="Day-to-Day Hindi">üïâÔ∏è Simple Hindi</option>
                <option value="Global English">üåé Global English</option>
                <option value="Simple Marathi">üö© Simple Marathi</option>
            </select>
        </div>
    </div>

    <button class="btn-generate" id="genBtn" onclick="generateAd()">üöÄ Generate Ad & Script</button>

    <div id="loader">üíé ANALYZING GOALS & WRITING SCRIPT...</div>
    <div id="errorBox" class="error-msg"></div>

    <div id="results" class="output-grid">
        <div class="strategy-card">
            <h3 style="margin-top:0; color:white; border-bottom:1px solid #333; padding-bottom:15px; margin-bottom:20px;">üìä Strategic Blueprint</h3>
            
            <div class="data-row">
                <span class="data-label">Psychological Angle</span>
                <div class="data-value" id="resPsychology"></div>
            </div>

            <div class="data-row">
                <span class="data-label">Detailed Targeting</span>
                <div class="data-value" id="resTargeting"></div>
            </div>

            <div class="data-row">
                <span class="data-label">üé• 30-Sec Video Script (Reels/Stories)</span>
                <div class="script-box" id="resScript"></div>
            </div>

            <div class="data-row">
                <span class="data-label">Recommended CTA Button</span>
                <div class="data-value" id="resCTAExplanation" style="font-style: italic; color: #aaa;"></div>
            </div>
        </div>

        <div class="mockup-container">
            <h3 style="margin-top:0; text-align:center; color:#888; font-size:14px; margin-bottom:15px; letter-spacing:1px;">FEED PREVIEW</h3>
            <div class="ad-preview">
                <div class="ad-header">
                    <div class="ad-avatar"></div>
                    <div>
                        <div class="ad-brand-name">Your Brand</div>
                        <div class="ad-sponsored">Sponsored ¬∑ <span id="langTag"></span></div>
                    </div>
                </div>
                
                <div class="ad-text-top" id="mockupPrimary">Loading Copy...</div>
                
                <div class="ad-image-container">
                    <img id="mockupImg" src="" alt="Ad Creative">
                    <div id="imgLoader" style="position:absolute; color:#666; font-size:12px; font-weight:bold;">‚ú® RENDERING VISUAL...</div>
                </div>
                
                <div class="ad-footer">
                    <div class="ad-headline-area">
                        <div class="ad-footer-domain">yourwebsite.com</div>
                        <div class="ad-headline" id="mockupHeadline">Headline...</div>
                        <div class="ad-desc" id="mockupDesc">Link Description...</div>
                    </div>
                    <a href="#" class="ad-cta-btn" id="mockupCTA">Learn More</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const MAX_DAILY = 30;

    window.onload = () => {
        updateUsageUI();
        const savedKey = localStorage.getItem('_meta_v3_key');
        if (savedKey) document.getElementById('apiKey').value = savedKey;
    };

    function updateUsageUI() {
        const usage = getUsage();
        document.getElementById('used').innerText = usage;
        if (usage >= MAX_DAILY) {
            document.getElementById('genBtn').disabled = true;
            document.getElementById('genBtn').innerText = "Daily Limit Reached (30/30)";
        }
    }

    function getUsage() {
        const date = new Date().toISOString().split('T')[0];
        const data = JSON.parse(localStorage.getItem('_meta_v3_usage') || '{}');
        return data[date] || 0;
    }

    function trackUsage() {
        const date = new Date().toISOString().split('T')[0];
        const data = JSON.parse(localStorage.getItem('_meta_v3_usage') || '{}');
        data[date] = (data[date] || 0) + 1;
        localStorage.setItem('_meta_v3_usage', JSON.stringify(data));
        updateUsageUI();
    }

    async function generateAd() {
        const key = document.getElementById('apiKey').value.trim();
        const topic = document.getElementById('topic').value;
        const audience = document.getElementById('audience').value || "Broad Audience";
        const purpose = document.getElementById('purpose').value;
        const lang = document.getElementById('language').value;
        
        if (!key || !topic) return alert("Please enter API Key and Product Topic!");
        if (getUsage() >= MAX_DAILY) return alert("Daily limit reached!");

        localStorage.setItem('_meta_v3_key', key);
        
        // UI Reset
        const loader = document.getElementById('loader');
        const results = document.getElementById('results');
        const errorBox = document.getElementById('errorBox');
        
        loader.style.display = 'block';
        results.style.display = 'none';
        errorBox.style.display = 'none';
        document.getElementById('mockupImg').style.display = 'none';
        document.getElementById('imgLoader').style.display = 'block';

        // Advanced Prompt Logic
        const prompt = `Act as a Top 1% Meta Ads Expert.
        Product: "${topic}"
        Target Audience: "${audience}"
        Campaign Goal: "${purpose}"
        Language: "${lang}"
        
        TASK:
        1. Decide the BEST Call-To-Action (CTA) button (e.g. Shop Now, Learn More, Sign Up) based on the Goal.
        2. Write High-Converting Ad Copy (Primary Text, Headline) in "${lang}".
        3. Write a 30-Second Video Script (Hook, Body, CTA) for Reels.
        4. Create a Visual Prompt for the static image creative.
        
        OUTPUT STRICTLY AS JSON:
        {
            "psychology": "Explain the marketing angle used.",
            "visual_prompt": "Photorealistic prompt for image generation...",
            "primary_text": "Main ad caption in ${lang}. Use emojis.",
            "headline": "Punchy headline in ${lang}.",
            "description": "Short link description.",
            "cta_button": "The exact button text (e.g. Shop Now).",
            "cta_reason": "Why this button was chosen.",
            "targeting": "List of 5 precise interests.",
            "video_script": "Scene 1 (0-3s): [Visual] - Audio... \\nScene 2 (3-15s): ... \\nScene 3 (15-30s): ..."
        }`;

        try {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${key}`;
            const response = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] })
            });

            const data = await response.json();

            if (response.status === 429) {
                throw new Error("Quota Exceeded. Please try again tomorrow.");
            }

            if (!data.candidates) throw new Error("AI Generation Failed.");

            const text = data.candidates[0].content.parts[0].text;
            const jsonStr = text.replace(/```json/g, '').replace(/```/g, '').trim();
            const adData = JSON.parse(jsonStr);

            // Populate Strategy Data
            document.getElementById('resPsychology').innerText = adData.psychology;
            document.getElementById('resTargeting').innerText = adData.targeting;
            document.getElementById('resScript').innerText = adData.video_script;
            document.getElementById('resCTAExplanation').innerText = `${adData.cta_button} - ${adData.cta_reason}`;
            
            // Populate Mockup
            document.getElementById('mockupPrimary').innerText = adData.primary_text;
            document.getElementById('mockupHeadline').innerText = adData.headline;
            document.getElementById('mockupDesc').innerText = adData.description;
            document.getElementById('mockupCTA').innerText = adData.cta_button; // Dynamic Button Text
            document.getElementById('langTag').innerText = lang;

            // Generate Image via Pollinations
            const seed = Math.floor(Math.random() * 9999);
            const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(adData.visual_prompt)}?width=1080&height=1080&nologo=true&seed=${seed}&model=flux`;
            
            const imgEl = document.getElementById('mockupImg');
            imgEl.src = imageUrl;
            imgEl.onload = () => {
                document.getElementById('imgLoader').style.display = 'none';
                imgEl.style.display = 'block';
            };

            results.style.display = 'grid';
            trackUsage();

        } catch (err) {
            errorBox.innerText = "Error: " + err.message;
            errorBox.style.display = 'block';
        } finally {
            loader.style.display = 'none';
        }
    }
</script>

</body>
</html>
